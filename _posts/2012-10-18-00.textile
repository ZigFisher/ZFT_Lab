---
layout:     post
title:      "Реверс-инжениринг и модификация плат RTA1025W"
tagline:    ""
category:   ""
group:      best
tags:       [best, hwmod, broadcom]
---

h3. Описание RTA1025W

p. Данный тип платы применяется в роутерах Siemens SL2-141(i), Dinalynk и некоторых других.

* Chipset: BCM6345
* Memory:  16MB
* Flash:   4MB


h3. Схема и поиск решения

p. Путём не слишком сложных манипуляций для людей, знакомых с паяльником, возможна установка и активация USB-хоста для подключения дополнительных устройств.

!/images/2012101801.jpg!

p. Отсутствующие детали, под которые есть место на печатной плате, обозначены на схеме пунктирной линией. Дополнительные детали указаны на схеме в нижнем левом блоке.

!/images/2012101851.jpg!:/files/schematics/2012101851B.jpg

p. Основную часть времени по переделке занял поиск входа процессора, активирующий HOST-режим у второго USB порта модема.

p. Для этого на одной нерабочей плате пришлось снять процессор и прозванивать дорожки. Огромную помощь оказал mr.Sergg, большое спасибо ему !

p. Для активации HOST-режима оказалось достаточным подать +3.3V через резистор 15k на контактную площадку USB1_PWRFLT.

!/images/2012101802.jpg!


h3. USB-хост - исполнение v.0.1

p. Первый экспериментальный образец был собран на скорую руку из первых попавшихся комплектующих.

!/images/2012101803.jpg!

p. Позже были опробованы: 3G и CDMA модемы, флешки, жесткий диск (с внешним питанием), звуковая карта, UVC вебкамера, USB адаптеры 1-Wire и I2C.

p. Все определяется на уровне ядра и при подгрузке необходимых модулей, работает.

!/images/2012101804.jpg!


h3. USB-хост - исполнение v.2.0

p. После отработки решения, был выполнен более качественный монтаж.

p. Выход 5V встроенного стабилизатора напряжения можно подать непосредственно на USB разъем (указаны маркером).

!/images/2012101815.jpg!

p. Платы бывают выполнены на текстолите с разным качеством и цветом.

!/images/2012101805.jpg!

!/images/2012101814.jpg!

p. На шине данных удобно становятся SMD резисторы развязки. Токоограничивающими резисторами и конденсаторами развязки пока можно пренебречь (см.схему).

!/images/2012101807.jpg!

p. Так-же оказалось возможным установить вместо телефонного RJ11 разьёма USB, отверстие в корпусе расширять не пришлось, USB-SLAVE и USB-HOST оказались рядом.

!/images/2012101806.jpg!


h3. Стабилизатор питания 5V для USB-хоста

p. Для питания USB устройств можно иcпользовать как встроенный стабилизатор 7805, так и внешний с возможностью управления по GPIO, например 78R05.

p. Использование такого стабилизатора имеет свои преимущества - управляя по GPIO, можно перезагрузить модем, WEB-камеру, интерфейс шины данных 1-Wire/I2C или отключить HDD.

!/images/2012101808.jpg!

p. На представленном фото размещена самодельная плата управляемого импульсного стабилизатора повышенной мощности 12V=>5V (не греется, спокойно "держит" HDD).

!/images/2012101809.jpg!


h3. Добавление COM-порта

p. Достаточно часто возникает необходимость подключения различных устройств к роутерам по RS232 (электронные весы, кассовые аппараты, системы сигнализации/оповещения и т.д.).

!/images/2012101810.jpg!

p. Для этих целей была разработана плата ttl_2_serial переходника. Плата подключается к консольному порту роутера и имеет управляющий вход от GPIO (что-бы логи загрузки роутера не попадали на COM-порт подключаемого устройства).

!/images/2012101811.jpg!

p. Более детальное фото платы. На выходе COM-порта временно, для проверки, установлена перемычка.

!/images/2012101812.jpg!


h3. Кластер из плат

p. При помощи латунных стоек модемы можно собирать в кластер. Это достаточно удобно для организации пула USB модемов или других решений.

!/images/2012101813.jpg!


h3. Источник питания

p. В оригинале, роутер поставляется с блоком питания переменного тока.

p. Для того, что-бы подать питание на роутер от источника постоянного тока 12V (блок питания или аккумулятор + солнечная батарея) необходимо выпаять диодный мост BG1, запаять перемычки на место отсутствующих резисторов R128 и R106, замкнуть предохранитель F101 перемычкой или установить на большую мощность.

!/images/2012101852.jpg!:/files/schematics/2012101852B.jpg
