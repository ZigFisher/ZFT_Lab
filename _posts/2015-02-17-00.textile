---
layout:     post
title:      "IoT контроллер ESP8266 и обмен данными M2M"
tagline:    ""
category:   ""
group:      smarthouse
tags:       [esp8266]
---


h3. Получение данных и выполнение команд в браузере

|_.Команда                       |_. Краткое пояснение                                                                                      |
|/configpro                      |Страница для ввода ключа для перехода в режим Pro.                                                        |
|/configpwm                      |Страница настроек PWM.                                                                                    |
|/debug                          |Показать отладочную страницу модуля.                                                                      |
|/gpioprint                      |Показать статус GPIO, работающих на выход.                                                                |
|/gpioprintinput                 |Показать статус GPIO, работающих на вход.                                                                 |
|/pwmprint                       |Показать статус PWM и их значение                                                                         |
|/restart                        |Перезагрузить модуль.                                                                                     |
|/sensors                        |Данные с сенсоров для локальной обработки.                                                                |
|                                |                                                                                                          |
|/configsave.bin?pg=60           |Сохранение настроек WiFi для flash 512к                                                                   |
|/configsave.bin?pg=130          |Сохранение настроек WiFi для flash 1mB                                                                    |
|/display?led=0&flash=1          |Отключить подсветку LCD или OLED дисплея и сохранить                                                      |
|/display?led=1&flash=1          |Включить подсветку LCD или OLED дисплея и сохранить                                                       |
|/lcdmsg?st=X&txt=my_text        |Вывод информации на LCD дисплей. X - номер строки, начиная с 0. Пробелы в тексте заменять подчёркиваниями.|
|/lcdmsg?st=6&txt=Hello&font=2   |Практический пример управления шрифтом на OLED экране.                                                    |
|/pwm?ch=X&set=Y                 |Управление PWM, где X - канал, а Y - значение 0-255.                                                      |
|/pwm?ch=X&set=Y&flash=1         |Управление PWM, с сохранением настроек в память.                                                          |
|/readrfid?pg=X                  |Чтение блока X (144 байт), вывод в hex, если не зашифрован                                                |
|/pcfdac?set=X                   |Управление PCF8591, где X - значение DAC 0-255.                                                           |
|/pcfgpio?adr=20&pin=X&set=Y     |Управление PCF8574, где X - выход 0-7, а Y - статус 0/1.                                                  |
|/i2cgo?adr=48&set=4YFF&getlen=2 |где Y это номер канала ADC 1-4.                                                                           |
|/i2cgo?adr=77&set=AA&getlen=2   |Пример - получение калибровочных данные BMP180.                                                           |
|/i2cgo?adr=3C&set=00AF          |Включить OLED дисплей.                                                                                    |
|/i2cgo?adr=3C&set=00AE          |Выключить OLED дисплей.                                                                                   |
|/i2cgo?adr=3C&set=0081XX        |Изменения яркости OLED дисплея, где XX от 00 до 99                                                        |
|/i2cgo?adr=28&set=26X0          |Управление усилением RFID, где X - это уровень усиления, от 0 до 7                                        |
|/i2cgo?adr=28&set=26&getlen=1   |Узнать уровень услиения RFID, должно быть от 00 до 70                                                     |
|/irremote?pin=Y&cmd=XXXXXXX     |Отправка ИК команды, где Y - номер GPIO, а X - сама команда                                               |
|                                |                                                                                                          |

p{color:orange}. Раздел не дописан...

p. .



h3. Использование прокси FlyMon => MQTT

p. Используя сервис FlyMon вы можете получать телеметрические данные с различных сенсоров на телефонах и планшетах с OS Android по протоколу MQTT.

p. Для этого подойдет любая программа, в которой есть возможность указать произвольный сервер. Список некоторых открытых и бесплатных программ для Android (MyMQTT рулит):

* "MyMQTT":https://play.google.com/store/apps/details?id=at.tripwire.mqtt.client
* "HomA":https://play.google.com/store/apps/details?id=st.alr.homA
* "MQTT Example":https://play.google.com/store/apps/details?id=se.goransson.mqttexample
* "IoT Manager":https://play.google.com/store/apps/details?id=ru.esp8266.iotmanager

p. В самом начале, в качестве сервера необходимо указать esp8266.flymon.net. По-умолчанию используется стандартный TCP порт 1883. Логин и пароль - demo@flymon.net demo2015.

p. Так-же нужно подписаться на топик (заголовок) который вы хотите контролировать. Основные примеры на данный момент будут выглядеть так:

|_.Топик                          |_. Краткое пояснение                                  |
|demo@flymon.net/#                |показывать все метрики по всем устройствам flymon.net |
|demo@flymon.net/18fe34986fe3/#   |показывать все метрики на устройстве с данным MAC-ом  |
|demo@flymon.net/18fe34986fe3/dsw1|показывать метрику dsw1 на определенном устройстве    |
|demo@flymon.net/+/dsw1           |показывать конкретную метрику на всех устройствах     |
|                                 |                                                      |



h3. Прямое управление модулем по протоколу MQTT

p. При наличии связи между MQTT сервером и ESP8266 допускается прямое управление модулем с планшета или телефона. Для этого необходимо в программе указать топик команды и её параметры в виде числового значение или текстового сообщения.

p. Топик должен начинаться с логина (login) выданного администратором MQTT сервера (так-же прописывается в модуле) и имени устройства (hostname) которое пользователь может назначить самостоятельно. Разделителем адресной части топика является слэш (/).

p. Пример полного правильного написания - my_login/esp_hostname/lcd/light

|_.Команда       |_. Краткое пояснение                                               |
|/gpio/output/X  |Управление GPIO, где X - его номер. Допустимые значения - 0 и 1.   |
|/gpio/pwm/X     |Управление PWM, где X - его номер. Допустимые значения - 0-255.    |
|/lcd/line/X     |Вывод информации на LCD дисплей, где X - номер строки, начиная с 0.|
|/lcd/light      |Управление подсветкой LCD дисплея. Допустимые значения - 0 и 1.    |
|                |                                                                   |

---

h3. Внешние ссылки

* "Homes-Smart: Список метрик, передаваемых на сервера":http://homes-smart.ru/index.php/oborudovanie/bez-provodov-wi-fi/67-otpravka-dannykh-na-http-server-majordomo-na-esp8266

---

h3. Внутренние ссылки

<ul>
  {% assign pages_list = site.posts %}
  {% assign group = 'smarthouse' %}
  {% include JB/pages_list %}
</ul>
