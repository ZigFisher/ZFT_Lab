---
layout:     post
title:      "Запуск Buildroot и OpenWrt на устройствах с SoC Hisilicon"
tagline:    ""
category:   ""
group:      ipcam
tags:       [hi3516c, ipcam, zftlab]
---


h3. Введение

p. Материал по проекту находится в стадии оформления. Последнее обновление - 2018.02.21

p{color:red}. Используя данный Сайт, Вы выражаете свое согласие с "«Отказом от ответственности»":/disclaimer.html и принимаете всю ответственность за выполняемые действия с оборудованием и программным обеспечением на себя !

p{color:blue}. Просьба - при использовании материалов с сайта в своих проектах, указывать первоисточник. Спасибо!


---


h3. Эксперименты Buildroot & OpenWrt

p. Данные прошивки предназначены исключительно для экспериментов и опытных пользователей, умеющих работать с UART консолью, TFTP сервером и командами U-boot.

p. В текущих тестовых прошивках пока нет поддержки Video, запись на FLASH не производится, старт системы происходит из памяти (INITRAMFS). Сейчас проверяется возможность загрузки ядра Linux на разных процессорах Hisilicon, корректность работы интерфейсов Ethernet и USB, поддержка минимальной файловой системы, автоматический детект сенсоров.

p. Теперь все компоненты (утилиты и библиотеки) в проекте "XM IPCam modding":https://zftlab.org/pages/2018010700.html собираются при помощи нашего "OpenWrt toolchain":https://github.com/ZigFisher/chaos_calmer размещённого на "GitHub":https://github.com/ZigFisher и там-же находится простейшая "Вики":https://github.com/ZigFisher/chaos_calmer/wiki/IPCam-with-Hisilicon-SoC's для сбора информации об различных IPCam в группе "Telegram":http://t.me/joinchat/FhtyHxDpQsv8HlRliQDgqw

p. Начат сбор и запись информации в "OpenWrt Wiki":https://openwrt.org/docs/hardware/soc#hisilicon

---


h3. Архив прошивок

p. Внимание! Если у вас камера не XM производителя и имеет на плате внешний Ethernet PHY (RTL8201 или IP101) - пробуйте использовать в первую очередь прошивки с именами -notXM.

|_=. Список поддерживаемых платформ     |_\2=. Сборка Buildroot                                                                                                                                                                          |_\2=. Сборка OpenWrt                                                                                                                                                                         |
|=. и разделение по типам Ethernet PHY  |=. for XM dev                                                                                  |=. for notXM dev                                                                                |=. for XM dev                                                                                 |=. for notXM dev                                                                              |
|=. SoC HI3516Cv1, HI3518Cv1, HI3518Ev1 |=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/buildroot/soc_v1|=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/buildroot/soc_v1 |=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/openwrt/soc_v1 |=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/openwrt/soc_v1 |
|=. SoC HI3516Cv2, HI3518Cv2, HI3518Ev2 |=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/buildroot/soc_v2|=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/buildroot/soc_v2 |={color:green}. скоро                                                                         |={color:green}. скоро                                                                         |
|=. SoC HI3520Dv1, HI3521Dv1, HI3520?v2 |={color:orange}. в разработке                                                                  |={color:orange}. в разработке                                                                   |={color:orange}. в разработке                                                                 |={color:orange}. в разработке                                                                 |
|                                       |                                                                                               |                                                                                                |                                                                                              |                                                                                              |

p. Все пакеты программ, библиотек и модулей ядра для OpenWrt доступны (в формате .ipk) по "ссылке":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/openwrt_packages/

p. Тестирование выполнено успешно на IPCam:

* XM 02532 (HI3516Cv1) ; XM ? (HI3516Cv1 + LAN8710A)
* XM 06510 (HI3518Ev1)
* XM 18510 (HI3518Ev2) ; XM 18520 (HI3518Ev2)
* NVSIP unknown (HI3518Ev1 + RTL8201 PHY)

p. Тестирование выполнено успешно на XM NVR: 00117

p{color:green}. Просьба: присылайте ID проверенных устройств и не стесняйтезь задавать вопросы группе "Telegram":http://t.me/joinchat/FhtyHxDpQsv8HlRliQDgqw


---


h3. Загрузка прошивок в устройство

p. Скачайте тестовую прошивку Buildroot или OpenWrt под ваше устройство (см. таблицу выше).

p. Настройте любой TFTP сервер и положите на него скачанный фаил, переименовав его в uImage.

p. Выполните команды в UART консоли, нажав Ctrl+C для остановки загрузки ядра после подачи питания на модуль:

pre. #
setenv serverip 192.168.1.254                  // Устанавка адреса TFTP сервера
setenv bootargs mem=40M console=ttyAMA0,115200 // Установка переменных для передачи ядру
tftp 0x82000000 uImage                         // Загрузка в память экспериментальной системы
bootm 0x82000000                               // Старт системы из памяти

p. Или, если сервер указан правильно, те-же операции но одной строкой:

pre. setenv bootargs mem=40M console=ttyAMA0,115200 ; tftp 0x82000000 uImage ; bootm 0x82000000

p. Теперь после загрузки устройство с прошивками Buildroot и OpenWrt имеет одинаковый адрес - 192.168.1.10.

p. По-умолчанию, пароль для root не установлен, выполните команду passwd для его изменения.


---


h3. Подготовка, установка и обновление кода проекта

p. Подготовка в Debian/Ubuntu

pre. sudo apt-get install --no-install-recommends build-essential gawk git libncurses-dev python \
    subversion unzip zlib1g-dev

p. Первичная установка

pre. git clone https://github.com/ZigFisher/chaos_calmer.git
cd chaos_calmer
cp ./feeds.conf.default ./feeds.conf
./scripts/feeds update -a
./scripts/feeds install -a
cp -v target/linux/hisilicon/examples/.config_current ./.config
make clean && make -j1 V=s

p. Добавление некоторых программ из Glutinium

pre. cd chaos_calmer
echo "src-git glutinium https://github.com/ZigFisher/Glutinium.git" >>./feeds.conf
./scripts/feeds update glutinium
./scripts/feeds list -r glutinium    # вывод списка доступных пакетов
./scripts/feeds install empty etherdump homes-smart httping i2c-telemetry i2c-tools \
    littlewire micronucleus mercury236 microbe mini_snmpd remserial rs485conf tg-bot1 \
    vtun-lite

p. Обновление кода и рестарт сборки (ежедневно)

pre. cd chaos_calmer
git pull
cp -v target/linux/hisilicon/examples/.config_current ./.config
make clean && make -j1 V=s


---


p. -RTSP потоки доступны по адресам rtsp://192.168.1.15:554/0 и rtsp://192.168.1.15:554/1-

p. -Посылая сигнал -SIGUSR1 демону snapshotd можно добиться получения снимков (тестовая функция)-

p. -Альтернативный вариант для получения снапшотов и роликов - использовать утилиту *sample_venc*-

p. -snapshotd -p /tmp/ -f snap.jpg rtsp://127.0.0.1:554/0-


---


h3. Внутренние ссылки

<ul>
  {% assign pages_list = site.posts %}
  {% assign group = 'ipcam' %}
  {% include JB/pages_list %}
</ul>

---

h3. Внешние ссылки

* "Yandex.Disk: Китайские SDK для процессоров Hisilicon":https://yadi.sk/d/bFlKO3843SFV8v/SDK
* "FlyRouter: Готовые для использования программы и библиотеки":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/
* "OpenWrt Wiki по Hisilicon":https://openwrt.org/docs/hardware/soc#hisilicon
