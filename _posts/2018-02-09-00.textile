---
layout:     post
title:      "Запуск Buildroot и OpenWrt на устройствах с SoC Hisilicon"
tagline:    ""
category:   ""
group:      ipcam
tags:       [hi3516c, ipcam, zftlab]
---


h3. Введение

p. Материал по проекту находится в стадии оформления. Последнее обновление - 2018.02.21

p{color:red}. Используя данный Сайт, Вы выражаете свое согласие с "«Отказом от ответственности»":/disclaimer.html и принимаете всю ответственность за выполняемые действия с оборудованием и программным обеспечением на себя !

p{color:blue}. Просьба - при использовании материалов с сайта в своих проектах, указывать первоисточник. Спасибо!


---


h3. Эксперименты Buildroot & OpenWrt

p. Данные прошивки предназначены исключительно для экспериментов и опытных пользователей, умеющих работать с UART консолью, TFTP сервером и командами U-boot.

p. В текущих тестовых прошивках пока нет поддержки Video, запись на FLASH не производится, старт системы происходит из памяти (INITRAMFS). Сейчас проверяется возможность загрузки ядра Linux на разных процессорах Hisilicon, корректность работы интерфейсов Ethernet и USB, поддержка минимальной файловой системы, автоматический детект сенсоров.

p. С 2018.02.15 все компоненты (утилиты и библиотеки) в проекте "XM IPCam modding":https://zftlab.org/pages/2018010700.html собираются при помощи нашего "OpenWrt toolchain":https://github.com/ZigFisher/chaos_calmer размещённого на "GitHub":https://github.com/ZigFisher и там-же находится простейшая "Вики":https://github.com/ZigFisher/chaos_calmer/wiki/IPCam-with-Hisilicon-SoC's для сбора информации об различных IPCam в группе "Telegram":http://t.me/joinchat/FhtyHxDpQsv8HlRliQDgqw


---


h3. Архив прошивок

|_=. Список поддерживаемых платформ                              |_=. Сборка Buildroot                                                                      |_=. Сборка OpenWrt                                                                        |
|<. Для любых устройств XM с SoC HI3518Cv1, HI3518Cv1, HI3518Ev1 |=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/HI_SoC_v1/ |=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/HI_SoC_v1/ |
|<. Для любых устройств XM с SoC HI3518Cv2, HI3518Ev2            |=. "скачать":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/HI_SoC_v2/ |={color:green}. скоро                                                                     |
|<. Для любых устройств XM с SoC HI3520?v1,HI3521?v1             |={color:orange}. в разработке                                                             |={color:orange}. в разработке                                                             |
|<. Для любых устройств XM с SoC HI3520?v2                       |={color:orange}. в разработке                                                             |={color:orange}. в разработке                                                             |
|<. Для любых устройств Longse с SoC HI3518Ev2                   |={color:orange}. в разработке                                                             |={color:orange}. в разработке                                                             |
|                                                                |                                                                                          |                                                                                          |

p. Все пакеты программ, библиотек и модулей ядра для OpenWrt доступны (в формате .ipk) по "ссылке":http://flyrouter.net/downloads/software/ipcam/Open_Source_Project/packages/ 

p. Тестирование выполнено успешно на XM IPCam: 02532, 06510, 18510, 18520

p. Тестирование выполнено успешно на XM NVR: 00117

p{color:green}. Просьба: присылайте ID проверенных устройств и не стесняйтезь задавать вопросы группе "Telegram":http://t.me/joinchat/FhtyHxDpQsv8HlRliQDgqw


---


h3. Загрузка прошивок в устройство

p. Скачайте тестовую прошивку Buildroot или OpenWrt под ваше устройство (см. таблицу выше).

p. Настройте любой TFTP сервер и положите на него скачанный фаил, переименовав его в uImage.

p. Выполните команды в UART консоли, нажав Ctrl+C для остановки загрузки ядра после подачи питания на модуль:

pre. #
setenv serverip 192.168.1.254                  // Устанавка адреса TFTP сервера
setenv bootargs mem=40M console=ttyAMA0,115200 // Установка переменных для передачи ядру
tftp 0x82000000 uImage                         // Загрузка в память экспериментальной системы
bootm 0x82000000                               // Старт системы из памяти

p. Или, если сервер указан правильно, те-же операции но одной строкой:

pre. setenv bootargs mem=40M console=ttyAMA0,115200 ; tftp 0x82000000 uImage ; bootm 0x82000000

p. После загрузки устройство с прошивкой Buildroot имеет адрес 192.168.1.15, а OpenWrt - 192.168.1.10

p. По-умолчанию, пароль для root не установлен, выполните команду passwd для его изменения.


---


h3. Инициализация и обновление проекта

pre. #
cd chaos_calmer
git pull
./scripts/feeds update -a
#./scripts/feeds install -a
cp -v target/linux/hisilicon/examples/.config_current ./.config
make clean && make -j1 V=s
#

pre. #
# Добавление программ из Glutinium
cd chaos_calmer
cp ./feeds.conf.default ./feeds.conf
echo "src-git glutinium https://github.com/ZigFisher/Glutinium.git" >>./feeds.conf
./scripts/feeds update glutinium
./scripts/feeds list -r glutinium
./scripts/feeds install empty etherdump homes-smart httping i2c-telemetry i2c-tools
./scripts/feeds install littlewire  micronucleus mercury236 microbe mini_snmpd remserial
./scripts/feeds install rs485conf tg-bot1 vtun-lite
#


---


p. -RTSP потоки доступны по адресам rtsp://192.168.1.15:554/0 и rtsp://192.168.1.15:554/1-

p. -Посылая сигнал -SIGUSR1 демону snapshotd можно добиться получения снимков (тестовая функция)-

p. -Альтернативный вариант для получения снапшотов и роликов - использовать утилиту *sample_venc*-

p. -snapshotd -p /tmp/ -f snap.jpg rtsp://127.0.0.1:554/0-


---


h3. Внутренние ссылки

<ul>
  {% assign pages_list = site.posts %}
  {% assign group = 'ipcam' %}
  {% include JB/pages_list %}
</ul>

---

h3. Внешние ссылки

* "ZFT Lab. & Yandex.Disk: Китайские SDK для процессоров Hisilicon":https://yadi.sk/d/bFlKO3843SFV8v/SDK
* "ZFT Lab. & FlyRouter: Готовые для использования программы и библиотеки":http://flyrouter.net/downloads/software/ipcam/For_Developers/
