---
layout:     post
title:      "Встречаем приложение для Android - MQTT IoT"
tagline:    ""
category:   ""
group:      flymon
tags:       [esp8266, android, smarthouse]
---


h3. Описание возможностей

p. Вашему вниманию представлена альфа-версия приложения *MQTT IoT*, которое предназначено для управления устройствами на базе SoC ESP8266 с прошивкой "Homes-Smart":http://homes-smart.ru/esp8266, подключенными к сервису "FlyMon DMS":http://esp8266.flymon.net.

p. *MQTT IoT* поддерживает работу прошивок "Homes-Smart":http://homes-smart.ru/esp8266 *Free* в режиме отображения данных с сенсоров. При использовании прошивки "Homes-Smart":http://homes-smart.ru/esp8266 *Pro* и включённой опции MQTT в "конструкторе":http://esp8266.homes-smart.ru/, возможно практически полное управление устройством ESP8266.

p. Для работы приложения требуется Android 4.4.2 и выше (возможно, в будущем требования будут снижены до 4.0.3). Работа приложения проверена на версиях Android (список обновляем): 4.4.2, 5.0, 5.1.1. Так-же в настройках телефона необходимо *разрешить устанавливать программы из неизвестных источников*.

p. Приложение написано на языке *C#* в среде *Xamarin Android*. Его автором является разработчик, скрывающийся под ником *Dolfik*. Я выполняю промоутерские функции и занимаюсь организацией стыковки между "Homes-Smart":http://homes-smart.ru/esp8266, "FlyMon DMS":http://esp8266.flymon.net и "MQTT IoT":http://zftlab.org/pages/2015072700.html. Отдельное спасибо пользователю с ником *ZyyyRu* за предоставленные скриншоты.

p. По всем вопросам, связанным с работой приложения, пишите на "форуме":http://homes-smart.ru/index.php/component/kunena/5-soft/894-android-klient-dlya-proshivok-homes-smart-mqtt-iot.

p=. !=/images/2015072740.jpg!

p=. Примерно так выглядит оформленный Dashboard.

---

h3. Установка приложения и История версий

p. В настоящее время приложение можно скачать с файлового архива блога "ZFT Lab.":http://zftlab.org/files/software_android/.

p. В ближашем будущем, приложение будет доступно в "Google":http://google.com маркете. В "Yandex":yandex.com маркете оно доступно уже сейчас для устройств с Android 5.0 и выше.

p. Баги и планы развития вынесены на "форум Homes-Smart":http://homes-smart.ru/index.php/component/kunena/5-soft/894-android-klient-dlya-proshivok-homes-smart-mqtt-iot. "FAQ":http://zftlab.org/pages/2015072700.html находится внизу данной страницы.

p{color:red}. При обновлении, полностью удаляйте старое приложение и только потом ставьте новую версию !

---

p{color:green}. *MQTT_IoT_FlyMon_v.0.1.11_20151208.apk*

* теперь нет надобности в обязательно включенном WiFi (приложение работает и по GPRS/CDMA каналу)
* реализована отправка статистической информации о работе приложения на сервер FlyMon (см. вкладку About)
* разобрались с получением данных о статусе GPIO в приложении (нужен ActiveSend режим для GPIO-out на модуле ESP)


p. "MQTT_IoT_FlyMon_v.0.1.11_20151207.apk":http://zftlab.org/files/software_android/

* исправлена работа с PWM (в предидущей версии вне зависимости от введенных значений было 0-100)
* тестовая идентификация и классификация Android устройств
* использована новая нумерация версий


p. "MQTT_IoT_FlyMon_20150806.apk":http://zftlab.org/files/software_android/

* рефакторинг контролов
* убраны дублирующиеся иконки
* добавлена возможность указания в топиках "+" и "#"


p. "MQTT_IoT_FlyMon_20150802.apk":http://zftlab.org/files/software_android/

* исправлена проблема закрытия приложения при смене ориентации Dashboard
* исправлена ошибка с неработающим Disconnect сессии
* исправлена ошибка с неработающим Exit в приложении
* добавлена возможность установки тематических иконок на каждый контрол
* добавлена авто-подстановка логина в начало набираемого топика


p. "MQTT_IoT_FlyMon_20150801.apk":http://zftlab.org/files/software_android/

* глобальная оптимизация кода, рефакторинг
* исправлены ошибки при подключении к серверу
* изменена нумерация версий приложения
* добавлена информация в раздел About
* исправлена проблема с пропаданием контролов в Dashboard
* добавлен новый тип контрола для отправки текстовых сообщений на LCD/OLED


p. "MQTT_IoT_FlyMon_20150731.apk":http://zftlab.org/files/software_android/

* переделан алгоритм подключения к MQTT серверу


p. "MQTT_IoT_FlyMon_20150730.apk":http://zftlab.org/files/software_android/

* изменён алгоритм подключения к MQTT серверу
* снижено требование к Android до 4.2.2


p. "MQTT_IoT_FlyMon_20150727.apk":http://zftlab.org/files/software_android/

* первая публичная доступная версия



---

h3. Базовая настройка приложения

p=. !/images/2015072701.jpg!

p=. После установки, запустите приложение *MQTT IoT*.

---

p=. !=/images/2015072702.jpg!

p=. Выберите в свойствах раздел *Settings*.

---

p=. !=/images/2015072703.jpg!

p=. Заполните поля, согласно скриншота и подсказки. Нажимите кнопку *Add*.

* Name - название сервиса, можно написать произвольное имя
* Host - сервер мониторинга esp8266.flymon.net (фиксирован)
* Port - 1883, оставляем по-умолчанию
* Login - demo@flymon.net для теста или E-mail в случае использования своего аккаунта
* Pass - demo для теста или ваш пароль в случае использования полноценного аккаунта
* Client ID - оставляем значение по-умолчанию, созданное автоматически
* Protocol - меняем на версию MQTT 3.1

---

p=. !=/images/2015072704.jpg!

p=. Нажмите кнопку *Connect*.

---

p=. !=/images/2015072705.jpg!

p=. Убедитесь, что соединение установлено (вверху, на иконке приложения зелёная галочка).

---

p=. !=/images/2015072706.jpg!

p=. Установите галочку *Remember me*.

---

h3. Работа приложения в упрощённом режиме FlyMon proxy

p. В *Free* версии прошивки "Homes-Smart":http://homes-smart.ru/esp8266 работа по протоколу MQTT не активирована. Однако, включив на модуле передачу данных на сервис "FlyMon DMS":http://esp8266.flymon.net, можно воспользоваться режимом proxy и получать данные с ESP8266 в любой точке мира.

p=. !=/images/2015072707.jpg!

p=. Выберите в свойствах раздел *Dashboard*.

---

p=. !=/images/2015072708.jpg!

p=. Нажмите *+*. Откроется окно ввода данных.

---

p=. !=/images/2015072709.jpg!

p=. Заполните поля, согласно скриншота и подсказки. Нажимите кнопку *Add*.

* Name - название сенсора или его местоположение
* Type - выберите *readonly value*
* Topic - путь в сенсору (demo@flymon.net/mac_устройства/название_метрики)
* Unit - обозначение единицы измерения (C, %, mmHg и т.д.)

p. При создании MQTT топика используйте "Список отслеживаемых метрик ESP8266 HomesSmart":http://zftlab.org/pages/2014122400.html

---

p=. !=/images/2015072710.jpg!

p=. Теперь каждые 5 мин. обновлённые данные с ESP8266 будут видны на экране.

---

h3. Работа приложения в полноценном режиме MQTT

p. При использовании *Pro* версии прошивки "Homes-Smart":http://homes-smart.ru/esp8266 не забудьте активировать для работы по протоколу MQTT соответствующий раздел в конструкторе.

p=. !=/images/2015072721.jpg!

p=. Выберите в свойствах раздел *Dashboard*. Нажмите значок "+".

---

p=. !=/images/2015072722.jpg!

p=. Для получения данных с сенсоров выберите правильный Type.

---

p=. !=/images/2015072723.jpg!

p=. Заполните поля, согласно скриншота и подсказки. Нажимите кнопку *Add*.

* Name - название сенсора или его местоположение
* Type - выберите *readonly value*
* Topic - путь в сенсору по иерархии MQTT (ваш@email/hostname_устройства/тип_метрики/название_метрики)
* Unit - обозначение единицы измерения (C, %, mmHg и т.д.)

p. При создании MQTT топика используйте "Рабочие примеры MQTT топиков Homes-Smart ESP8266":http://zftlab.org/pages/2015080300.html

---

p=. !=/images/2015072724.jpg!

p=. Пример добавления темературы с датчика DHT22.

---

p=. !=/images/2015072725.jpg!

p=. Пример добавления темературы с датчика DHT22 (второй).

---

p=. !=/images/2015072726.jpg!

p=. Пример добавления темературы с датчика AM2321.

---

p=. !=/images/2015072727.jpg!

p=. Пример добавления темературы с датчика BMP180.

---

p=. !=/images/2015072728.jpg!

p=. Пример добавления темературы с датчика SHT21.

---

p=. !=/images/2015072729.jpg!

p=. Пример добавления влажности с датчика DHT22.

---

p=. !=/images/2015072730.jpg!

p=. Пример добавления влажности с датчика DHT22 (второй).

---

p=. !=/images/2015072731.jpg!

p=. Пример добавления влажности с датчика AM2321.

---

p=. !=/images/2015072732.jpg!

p=. Пример добавления влажности с датчика SHT21.

---

p=. !=/images/2015072733.jpg!

p=. Пример добавления атмосферного давления с датчика BMP180.

---

p=. !=/images/2015072734.jpg!

p=. Пример добавления освещённости с датчика BH1750.

---

p=. !=/images/2015072735.jpg!

p=. Пример добавления размера свободной памяти модуля ESP8266.

---

p=. !=/images/2015072736.jpg!

p=. Пример добавления времени работы модуля ESP8266.

---

p=. !=/images/2015072737.jpg!

p=. Для различного рода переключателей необходимо выбрать тип данных "on-off switch".

---

p=. !=/images/2015072738.jpg!

p=. Пример добавления включения подсветки LCD дисплея.

---

p=. !=/images/2015072739.jpg!

p=. Пример добавления включения реле на gpio5.

---

p=. !=/images/2015072740.jpg!

p=. Примерно так выглядит оформленный Dashboard.

---


---

h3. Часто задаваемые вопросы (FAQ)

p. *Ответы на вопросы будут оформлены на днях...*

p. Как правильно составить MQTT топик для ESP8266 ?

p. Случайно стер Client ID в приложении. Что теперь там писать ?

p. Как получить аккаунт на MQTT сервере FlyMon ?

p. При включении приложения, данные в Dashboard появляются не сразу. Это нормально ?

---

h3. Внутренние ссылки

<ul>
  {% assign pages_list = site.posts %}
  {% assign group = 'smarthouse' %}
  {% include JB/pages_list %}
</ul>
