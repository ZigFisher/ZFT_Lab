---
layout:     post
title:      "Моддинг прошивки IP камеры HI3518E_50H10L_S39 - ID 6510"
tagline:    ""
category:   ""
group:      ipcam
tags:       [hi3518e, ipcam, zftlab]
---


h3. Эпиграф

p. Пока Билли Бонс пьёт ром в трактире "Адмирал Бенбоу", его соперник Джон Сильвер собирает команду и готовится считать пиастры....

---

h3. Введение

p. Начало работы над проектом. Материал в стадии оформления.

p. Последнее обновление - 2018.01.26 22:10

---

p=. !/images/2018010701.jpg!

p=. Вариант подключения распространённого USB WiFi донгла к плате HI3518E_50H10L_S39

---

p=. !/images/2018010712.jpg!

p=. Пример отображения альтернативного WEB-интерфейса IPCam для партнёра "Octonix":https://www.facebook.com/octonix.net/

---

p=. !/images/2018010711.jpg!

p=. Консольный вывод информации о сетевых интерфейсах - работа идет через USB WiFi

---

h3. Задачи и возможности модифицированной прошивки

p. Прошивка создаётся для внутренних нужд ZFT Lab. и партнёрских проектов.

p. Принять участие в тестировании можно после письменного обращения на контактный Email.

p. Прошивка позволяет подключать через USB интерфейс:

* Flash-накопители ёмкостью до 32Gb с файловой системой VFAT
* Wi-Fi донглы на чипсетах MT7601, RTL8188 и RT3070 (у последнего пока некоторые проблемы)
* 3G/4G модемы, работающие в режиме стандартных портов ввода-вывода ttyACM и ttyUSB (тест)

p. Прошивка позволяет строить L2 VPN туннели:

* На публичные партнёрские сервера - FlyHub.org, FlyMon.net, Octonix.net и ZFTLab.org
* На любые приватные сервера с OS Linux (Debian/Ubuntu предпочтительны, есть инструкция)

p. Прошивка позволяет отправлять уведомления и скриншоты с камеры:

* При срабатывании внешнего датчика движения и замыкании контактов на PCB
* Отправка может осуществляться как на E-mail, так и в группу Telegram

p. Прошивка имеет альтернативный WEB-интерфейс, который:

* Работает параллельно с унылой поделкой китайских разработчиков
* Работает в любом браузере и на любом устройстве, в т.ч. на мобильных телефонах
* Имеет современный дизайн и систему автоматически настраиваемых плагинов
* Может быть оперативно изменён под дизайн проекта заказчика или интегратора

p. Прошивка содержит множество скриптов, модулей ядра и GPL программ, собранных из исходников (см.ниже)

p. Прошивка  разрабатывается *специально* для устройств с малым объёмом FLASH памяти (8 Mb)

p. Прошивка содержит скрипты *специально* написанные в student-style дабы начинающие могли разобраться

---

h3. Расчёт максимального размера разделов, предоставленный "ESonya":http://www.cctvsp.ru/

pre. #####################################
custom-x.cramfs.img   40000h   262144
romfs-x.cramfs.img   370000h  3604480
user-x.cramfs.img    280000h  2621440
web-x.cramfs.img     140000h  1310720
#####################################

---

h3. Программы

* bwm-ng -
* dropbear -
* haserl - простой CGI интерпретатор
* vtund -
* wpa_passphrase -
* wpa_supplicant -

---

h3. Дополнительные аплеты из busybox2

* brctl
* crond
* df dmesg
* hostname httpd
* klogd
* logger logread lsusb
* microcom mkfs.vfat
* nc nice ntpd
* sendmail sha1sum sort syslogd
* tail telnet tr
* uniq uptime
* vi
* wget

pre. ls -la /bin /sbin | awk '/busybox2/ {print $9}' | sort

---

h3. Скрипты

* ipcam_plugin - скрипт,
* ipcam_setup - скрипт, отвечающий за генерацию и проверку основного конфига /etc/ipcam.conf
* ipcam_tunnel - скрипт,
* ipcam_wifi - скрипт,
* tapip - скрипт,
* wifi - скрипт,

---

h3. Модули ядра (3.0.8)

* 8188eu.ko (884060) - поддержка USB WiFi донгла на чипе RTL8188
* mt7601Usta.ko (1030420) - поддержка USB WiFi донгла на чипе MT7601
* rt3070sta.ko (793339) - поддержка USB WiFi донгла на чипе RT3070
* usb-storage.ko (80334) - поддержка USB Flash донгла (диск доступен как /dev/sda)

---

h3. Конфигурационные файлы

* /etc/ipcam.conf - основной конфигурационный файл системы, пример представлен ниже
* /var/tmp/vtund.conf - файл конфигурации VTUNd, генерируется автоматически
* /var/tmp/wpa_supplicant.conf - файл конфигурации WPA/WPA2 суппликанта, генерируется автоматически

---

h3. Пример конфигурационного файла /etc/ipcam.conf

pre. #
# ZFT Lab. 2018 | http://zftlab.org/pages/2018010700.html
# Simple example of IPCam config (autogenerated)
#
device_name=IPCam                 # Имя устройства
device_tid=0012140138CA           # Идентификатор устройства на базе MAC eth0
getty_enable=0                    # Активация доступа в консоль камеры
mqtt_enable=0                     # -пока не используется- Активация MQTT клиента
mqtt_server=ipcam.flymon.net      # -пока не используется- DNS имя или IP адрес MQTT сервера
mqtt_port=1883                    # -пока не используется- Порт MQTT сервера
mqtt_login=demo                   # -пока не используется- Логин MQTT клиента (email)
mqtt_password=test2018            # -пока не используется- Пароль MQTT клиента
sshd_enable=1                     # Активация SSH сервера (временно заблокирован)
sshd_port=22                      # Порт SSH сервера
storage_enable=0                  # Активация драйвера USB флешки
syslogd_enable=0                  # Активация SYSLOGd и KLOGd и соответственно logread
telegram_enable=0                 # -не используется- Активация Telegram бота
telegram_token=none               # -не используется- Токен Telegram бота
telegram_rupor=none               # -не используется- ID чат-группы в Telegram
telnetd_enable=1                  # Активация Telnet сервера
telnetd_port=23                   # Порт Telnet сервера
vtund_enable=1                    # Активация VTUNd клиента
vtund_server=ipcam.flymon.net     # DNS имя или IP адрес VTUNd сервера
vtund_port=7321                   # -не используется- Фиксировано 5000
vtund_password=02e3e2266b9d...    # -не используется- Автогенерация
webface_enable=1                  # Активация HTTP сервера с альтернативным интерфейсом
webface_port=81                   # Порт HTTP сервера
wifi_enable=1                     # Активация драйвера USB WiFi (только MT7601 и RT3070)
wifi_ssid=CRMTGA                  # SSID WiFi точки доступа
wifi_password=crmtga2008fly       # Пароль точки доступа (psk создаётся автоматически)
wifi_type=auto                    # -не используется- Автодетект mt7601/rt3070/rtl8188
wifi_iface=auto                   # -не используется- Автодетект (ra0/eth2)=>wlan0
wifi_psk=auto                     # -не используется- Автогенерация psk
wifi_proto=auto                   # -не используется- Фиксировано WPA2
wifi_auth=auto                    # -не используется- Фиксировано AES/CCMP
wifi_network=dhcp                 # -не используется- Фиксировано DHCP
yandex_enable=0                   # -не используется- Активация доступа на Yandex.Disk
yandex_login=ipcam@yandex.com     # -не используется- Логин Yandex.Disk клиента (email)
yandex_password=test2018          # -не используется- Пароль Yandex.Disk клиента
yandex_folder=none                # -не используется- Папка для складирования снапшотов
yandex_interval=0                 # -не используется- Интервал загрузки фото на Yandex.Disk
#

---

h3. IPCam - Telegram

p. Ознакомиться с примером работы Telegram бота на камере можно зайдя в отдельную группу https://t.me/joinchat/FhtyHw3wQVxqhWEE05sYKA и выполнив команду /menu запросить кнопкой снапшот.

---

h3. Старт процедуры тестирования

p. Первоначально необходимо загрузить в камеру последнюю официальную "прошивку от производителя":https://zftlab.org/files/firmware_ipcam/General_HZXM_IPC_HI3518E_50H10L_S38_V4.02.R12.Nat.OnvifS.20170727_ALL.bin

p. После обновления и сброса устройства на заводские настройки можно пробовать заливать тестовые прошивки.

p. Заботясь о пользователях, в тестовые прошивки мы специально не включаем загрузчик (bootloader) и его обновление, так что сломать камеру при экспериментах достаточно трудно.

---

h3. Прошивки и патчи к ним

* Получить прошивки и принять участие в тестировании можно в группе Telegram (см. ссылки ниже)
* По мере тестирования, прошивки с проверенной частью функционала будут лежать в открытом доступе

---

h3. История изменений

* 2017.01.26 Первый публичный релиз на канале Telegram [getty, syslogd, telnetd, vtund, webface, wifi]

---

h3. План разработки и тестирования

* Добавить поддержку USB 1.1 устройств через драйвер ядра HIUSB OHCI
* Сделать возможным изменение пароля у root и создание новых пользователей в системе
* Создать меню для изменения настроек через telnet/ssh без использования редактора vi
* -
* -Добавить поддержку USB WiFi донгла Realtek rtl8188-

---

h3. Внутренние ссылки

<ul>
  {% assign pages_list = site.posts %}
  {% assign group = 'ipcam' %}
  {% include JB/pages_list %}
</ul>

---

h3. Внешние ссылки

* "Telegram group: Дискуссионный клуб":https://t.me/joinchat/FhtyHxDpQsv8HlRliQDgqw
* "Telegram group: Пример работы бота на IP-камере":https://t.me/joinchat/FhtyHw3wQVxqhWEE05sYKA
* -
* "Форум videon.spb.ru: Расширенная модификация прошивки для камер Xiong Mai":http://forum.videon.spb.ru/viewtopic.php?f=24&t=11357
* "Форум taker.im: Расширенная модификация прошивки для камер Xiong Mai":http://www.taker.im/phpBB2/topic/158005-%D0%BE%D0%B1%D0%B7%D0%BE%D1%80-%D0%BA%D0%B0%D0%BC%D0%B5%D1%80-%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%D0%BD%D0%B0%D0%B1%D0%BB%D1%8E%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F/page__st__2560#entry3153006 | "Обсуждение":http://www.taker.im/phpBB2/topic/158005-%D0%BE%D0%B1%D0%B7%D0%BE%D1%80-%D0%BA%D0%B0%D0%BC%D0%B5%D1%80-%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%D0%BD%D0%B0%D0%B1%D0%BB%D1%8E%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F/page__st__2560
* -
* "Описание файла конфигурации для wpa_supplicant":http://manpages.ylsoftware.com/ru/wpa_supplicant.conf.5.html
* "Rename a Linux network interface without Udev / Reboot":http://kernelpanik.net/rename-a-linux-network-interface-without-udev/
